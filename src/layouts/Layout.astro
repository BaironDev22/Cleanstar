---
export interface Props {
	title: string;
	description?: string;
}

const { title, description } = Astro.props;
import AnimationConfig from '../components/AnimationConfig.astro';

// Navbar component
const { pathname } = Astro.url;
const isLegalPage = pathname.includes('/politica-privacidad') || pathname.includes('/terminos-servicio');

const navItems = [
  { 
    title: "Inicio", 
    url: isLegalPage ? "/#inicio" : "#inicio", 
    label: "inicio" 
  },
  { 
    title: "Nosotros", 
    url: isLegalPage ? "/#nosotros" : "#nosotros", 
    label: "nosotros" 
  },
  { 
    title: "Servicios", 
    url: isLegalPage ? "/#servicios" : "#servicios", 
    label: "servicios" 
  },
  { 
    title: "Testimonios", 
    url: isLegalPage ? "/#testimonios" : "#testimonios", 
    label: "testimonios" 
  },
  { 
    title: "Contacto", 
    url: isLegalPage ? "/#contacto" : "#contacto", 
    label: "contacto" 
  }
];
---

<!doctype html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description || "Cleanstar Detailing - Servicio profesional de detailing automotriz en Villa Alemana"} />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
		
		<!-- Configuración global de AOS -->
		<AnimationConfig />
		
		<!-- Smooth scroll CSS global -->
		<style>
		  /* Scroll suave y mejorado */
		  html {
		    scroll-behavior: smooth;
		    scroll-padding-top: 100px; /* Espacio para navbar fijo */
		  }
		  
		  body {
		    scroll-behavior: smooth;
		    overscroll-behavior: none; /* Evita el bounce en móviles */
		  }
		  
		  /* Mejoras en el scrollbar */
		  ::-webkit-scrollbar {
		    width: 8px;
		  }
		  
		  ::-webkit-scrollbar-track {
		    background: rgba(255, 255, 255, 0.1);
		  }
		  
		  ::-webkit-scrollbar-thumb {
		    background: linear-gradient(180deg, #6b7280, #4b5563);
		    border-radius: 4px;
		  }
		  
		  ::-webkit-scrollbar-thumb:hover {
		    background: linear-gradient(180deg, #9ca3af, #6b7280);
		  }
		  
		  /* Reducir el motion para usuarios sensibles */
		  @media (prefers-reduced-motion: reduce) {
		    html {
		      scroll-behavior: auto;
		    }
		    
		    * {
		      animation-duration: 0.01ms !important;
		      animation-iteration-count: 1 !important;
		      transition-duration: 0.01ms !important;
		    }
		  }
		</style>
	</head>
	<body class="bg-gradient-to-br from-gray-900 to-black min-h-screen">
		<!-- Navbar profesional integrado en Layout -->
		<header class="fixed top-0 left-0 right-0 z-30 px-2 sm:px-4 py-2">
		  <nav class="relative flex items-center max-w-6xl mx-auto rounded-full px-3 sm:px-6 py-1 sm:py-2">
		    <!-- Logo con gradiente - posición absoluta izquierda -->
	        <div class="absolute left-3 sm:left-6 flex items-center z-10">
	          <a href={isLegalPage ? "/" : "#inicio"} class="flex items-center">
	            <div class="relative w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24">
	              <!-- Capa base del logo -->
	              <img 
	                src="/logo-cleanstar.png" 
	                alt="Cleanstar Detailing" 
	                class="absolute inset-0 w-full h-full object-contain"
	                style="filter: brightness(0) saturate(100%); opacity: 0.1;"
	              >
	              <!-- Capa gradiente superior -->
	              <img 
	                src="/logo-cleanstar.png" 
	                alt="Cleanstar Detailing" 
	                class="absolute inset-0 w-full h-full object-contain"
	                style="filter: brightness(0) saturate(100%) invert(87%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%); mask: linear-gradient(45deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0.8) 30%, rgba(0,0,0,0.4) 60%, rgba(0,0,0,0) 100%);"
	              >
	              <!-- Capa de color principal -->
	              <img 
	                src="/logo-cleanstar.png" 
	                alt="Cleanstar Detailing" 
	                class="absolute inset-0 w-full h-full object-contain"
	                style="filter: brightness(0) saturate(100%) invert(59%) sepia(11%) saturate(200%) hue-rotate(176deg) brightness(96%) contrast(85%);"
	              >
	            </div>
	          </a>
	        </div>
	        
	        <!-- Espaciador para el logo -->
	        <div class="w-16 h-16 sm:w-20 sm:h-20 lg:w-24 lg:h-24 flex-shrink-0"></div>
	        
	        <!-- Contenedor centrado para navegación y menú -->
	        <div class="flex-1 flex justify-end items-center">		    <!-- Desktop Navigation -->
		    <div class="hidden md:flex items-center space-x-1">
		      {isLegalPage && (
		        <a
		          class="relative block px-4 py-2 text-sm font-medium text-white transition-all duration-300 rounded-lg mr-2"
		          style="background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%); &:hover { background: linear-gradient(135deg, var(--color3) 0%, var(--color2) 100%); }"
		          aria-label="Volver al inicio"
		          href="/"
		        >
		          ← Volver al Inicio
		        </a>
		      )}
		      {navItems.map((link) => (
		        <a
		          class="relative block px-4 py-2 text-sm font-medium transition-colors duration-300 nav-link rounded-lg hover:bg-gray-800/20"
		          style="color: var(--color2); &:hover { color: var(--color1); }"
		          aria-label={link.label}
		          href={link.url}
		        >
		          {link.title}
		        </a>
		      ))}
		      <!-- CTA Button -->
		      <a 
		        href="#contacto"
		        class="text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 ml-2"
		        style="background: linear-gradient(135deg, var(--color4) 0%, var(--color3) 100%); &:hover { background: linear-gradient(135deg, var(--color3) 0%, var(--color2) 100%); }"
		      >
		        Cotizar
		      </a>
		    </div>

		    <!-- Mobile Menu Button -->
		    <button 
		      id="mobile-menu-button"
		      class="md:hidden w-8 h-8 sm:w-10 sm:h-10 flex flex-col justify-center items-center space-y-1 group"
		      aria-label="Toggle mobile menu"
		    >
		      <span class="w-5 sm:w-6 h-0.5 transition-all duration-300" style="background-color: var(--color2); .group:hover & { background-color: var(--color1); }"></span>
		      <span class="w-5 sm:w-6 h-0.5 transition-all duration-300" style="background-color: var(--color2); .group:hover & { background-color: var(--color1); }"></span>
		      <span class="w-5 sm:w-6 h-0.5 transition-all duration-300" style="background-color: var(--color2); .group:hover & { background-color: var(--color1); }"></span>
		    </button>
		    </div>
		  </nav>

		  <!-- Mobile Menu Overlay -->
		  <div 
		    id="mobile-menu-overlay" 
		    class="fixed inset-0 bg-black/50 backdrop-blur-sm opacity-0 invisible transition-all duration-300 md:hidden z-40"
		  ></div>

		  <!-- Mobile Menu -->
		  <div 
		    id="mobile-menu" 
		    class="fixed top-0 right-0 h-full w-full max-w-xs sm:max-w-sm backdrop-blur-lg border-l transform translate-x-full transition-transform duration-300 ease-in-out md:hidden z-50"
		    style="background: rgba(17, 24, 39, 0.98); border-color: var(--color3);"
		  >
		    <!-- Mobile Menu Header -->
		    <div class="flex justify-between items-center p-4 sm:p-6 border-b" style="border-color: var(--color3);">
		      <a href={isLegalPage ? "/" : "#inicio"} class="flex items-center hover:opacity-90 transition-opacity duration-300">
		        <div class="relative w-24 h-24 sm:w-28 sm:h-28">
		          <!-- Capa base del logo -->
		          <img 
		            src="/logo-cleanstar.png" 
		            alt="Cleanstar Detailing" 
		            class="absolute inset-0 w-full h-full"
		            style="filter: brightness(0) saturate(100%); opacity: 0.1;"
		          >
		          <!-- Capa gradiente superior -->
		          <img 
		            src="/logo-cleanstar.png" 
		            alt="Cleanstar Detailing" 
		            class="absolute inset-0 w-full h-full"
		            style="filter: brightness(0) saturate(100%) invert(87%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(98%) contrast(89%); mask: linear-gradient(45deg, rgba(0,0,0,1) 0%, rgba(0,0,0,0.8) 30%, rgba(0,0,0,0.4) 60%, rgba(0,0,0,0) 100%);"
		          >
		          <!-- Capa de color principal -->
		          <img 
		            src="/logo-cleanstar.png" 
		            alt="Cleanstar Detailing" 
		            class="absolute inset-0 w-full h-full"
		            style="filter: brightness(0) saturate(100%) invert(59%) sepia(11%) saturate(200%) hue-rotate(176deg) brightness(96%) contrast(85%);"
		          >
		        </div>
		      </a>
		      <button 
		        id="mobile-menu-close"
		        class="w-8 h-8 flex items-center justify-center transition-colors duration-300"
		        style="color: var(--color2);"
		        aria-label="Close mobile menu"
		      >
		        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
		          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
		        </svg>
		      </button>
		    </div>

		    <!-- Mobile Navigation Links -->
		    <nav class="p-4 sm:p-6">
		      <ul class="space-y-4">
		        {isLegalPage && (
		          <li>
		            <a
		              href="/"
		              class="mobile-nav-link block py-3 px-4 text-white hover:opacity-80 rounded-lg transition-all duration-300 font-medium text-center"
		              style="background: linear-gradient(135deg, var(--color4), var(--color3));"
		              aria-label="Volver al inicio"
		            >
		              ← Volver al Inicio
		            </a>
		          </li>
		        )}
		        {navItems.map((link, index) => (
		          <li>
		            <a
		              href={link.url}
		              class="mobile-nav-link block py-3 px-4 hover:opacity-80 rounded-lg transition-all duration-300 font-medium"
		              style="color: var(--color1); hover:background: var(--color3);"
		              aria-label={link.label}
		              style={`animation-delay: ${index * 0.1}s`}
		            >
		              {link.title}
		            </a>
		          </li>
		        ))}
		      </ul>

		      <!-- Mobile CTA -->
		      <div class="mt-6 sm:mt-8 pt-4 sm:pt-6 border-t" style="border-color: var(--color3);">
		        <a 
		          href="#contacto"
		          class="block w-full text-white text-center py-3 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105"
		          style="background: linear-gradient(135deg, var(--color4), var(--color3));"
		        >
		          Solicitar Cotización
		        </a>
		        
		        <!-- Contact Info -->
		        <div class="mt-6 text-center">
		          <p class="text-sm mb-2" style="color: var(--color2);">Contáctanos directamente:</p>
		          <a 
		            href="tel:+56912345678" 
		            class="font-medium block mb-1 hover:opacity-80 transition-opacity duration-300"
		            style="color: var(--color1);"
		          >
		            +56 9 1234 5678
		          </a>
		          <a 
		            href="mailto:info@cleanstar.cl" 
		            class="font-medium block hover:opacity-80 transition-opacity duration-300"
		            style="color: var(--color1);"
		          >
		            info@cleanstar.cl
		          </a>
		        </div>
		      </div>
		    </nav>
		  </div>
		</header>
		
		<div class="app-container" style="margin-top: 80px;">
			<slot />
		</div>

		<style>
		  nav {
		    animation: nav-shadow 1s linear both;
		    animation-timeline: scroll();
		    animation-range: 0 100px;
		    background: rgba(17, 24, 39, 0);
		    backdrop-filter: blur(0px);
		  }

		  @keyframes nav-shadow {
		    0% {
		      background: rgba(17, 24, 39, 0);
		      backdrop-filter: blur(0px);
		      box-shadow: none;
		    }
		    to {
		      background: rgba(17, 24, 39, 0.9);
		      backdrop-filter: blur(10px);
		      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
		      border: 1px solid rgba(255, 255, 255, 0.1);
		    }
		  }

		  /* Mobile menu hamburger animation */
		  #mobile-menu-button span {
		    transition: all 0.3s ease;
		    transform-origin: center;
		  }

		  /* Mobile menu overlay */
		  #mobile-menu-overlay {
		    z-index: 40;
		  }

		  /* Mobile menu panel */
		  #mobile-menu {
		    z-index: 50;
		    box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
		    max-width: 85vw;
		    min-width: 280px;
		  }

		  /* Ensure menu doesn't overflow on very small screens */
		  @media (max-width: 375px) {
		    #mobile-menu {
		      max-width: 90vw;
		      min-width: 260px;
		    }
		  }

		  @media (max-width: 320px) {
		    #mobile-menu {
		      max-width: 95vw;
		      min-width: 240px;
		    }
		  }

		  /* Mobile navigation links animation */
		  .mobile-nav-link {
		    opacity: 0;
		    transform: translateX(20px);
		    transition: opacity 0.3s ease, transform 0.3s ease, color 0.3s ease, background-color 0.3s ease;
		  }

		  /* Active state for desktop navigation */
		  .nav-link.active {
		    color: #60a5fa !important;
		  }

		  /* Responsive adjustments */
		  @media (max-width: 767px) {
		    /* Hide mobile menu elements when not needed */
		    .hidden-mobile {
		      display: none !important;
		    }
		    
		    /* Ensure proper spacing on mobile */
		    header {
		      padding: 0.5rem 0.75rem;
		    }
		    
		    nav {
		      padding: 0.5rem 1rem;
		    }

		    /* Ensure mobile menu is properly contained */
		    #mobile-menu {
		      right: 0;
		      top: 0;
		      bottom: 0;
		      height: 100vh;
		      height: 100dvh; /* Use dynamic viewport height for mobile browsers */
		      overflow-y: auto;
		      overflow-x: hidden;
		    }
		  }

		  /* Small screens */
		  @media (max-width: 640px) {
		    header {
		      padding: 0.5rem;
		    }
		    
		    nav {
		      padding: 0.5rem 0.75rem;
		    }
		  }

		  /* Extra small screens */
		  @media (max-width: 375px) {
		    header {
		      padding: 0.5rem 0.75rem;
		    }
		    
		    nav {
		      padding: 0.5rem 1rem;
		    }

		    #mobile-menu {
		      max-width: 100vw;
		      width: 100vw;
		    }
		  }

		  @media (min-width: 768px) {
		    /* Hide mobile menu elements on desktop */
		    #mobile-menu-button,
		    #mobile-menu,
		    #mobile-menu-overlay {
		      display: none !important;
		    }
		  }

		  /* Smooth scrolling for navigation links */
		  html {
		    scroll-behavior: smooth;
		  }

		  /* Prevent body scroll when mobile menu is open */
		  body.menu-open {
		    overflow: hidden;
		  }

		  /* Logo hover effects */
		  img[alt="Cleanstar Detailing"]:hover {
		    transform: scale(1.05);
		    transition: all 0.3s ease;
		  }

		  /* Fixed navbar height */
		  header {
		    height: auto;
		  }

		  nav {
		    min-height: 3.5rem;
		    height: 3.5rem;
		  }
		</style>

		<script>
		  document.addEventListener('DOMContentLoaded', function() {
		    const mobileMenuButton = document.getElementById('mobile-menu-button');
		    const mobileMenuClose = document.getElementById('mobile-menu-close');
		    const mobileMenu = document.getElementById('mobile-menu');
		    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
		    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link') as NodeListOf<HTMLElement>;
		    const navbar = document.querySelector('header');

		    // Function to open mobile menu
		    function openMobileMenu() {
		      mobileMenu?.classList.remove('translate-x-full');
		      mobileMenuOverlay?.classList.remove('opacity-0', 'invisible');
		      document.body.style.overflow = 'hidden';
		      document.body.classList.add('menu-open');
		      
		      // Animate hamburger to X
		      const lines = mobileMenuButton?.querySelectorAll('span') as NodeListOf<HTMLElement>;
		      if (lines) {
		        lines[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
		        lines[1].style.opacity = '0';
		        lines[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
		      }
		      
		      // Animate menu items
		      mobileNavLinks.forEach((link: HTMLElement, index: number) => {
		        setTimeout(() => {
		          link.style.opacity = '1';
		          link.style.transform = 'translateX(0)';
		        }, index * 100);
		      });
		    }

		    // Function to close mobile menu
		    function closeMobileMenu() {
		      mobileMenu?.classList.add('translate-x-full');
		      mobileMenuOverlay?.classList.add('opacity-0', 'invisible');
		      document.body.style.overflow = '';
		      document.body.classList.remove('menu-open');
		      
		      // Reset hamburger
		      const lines = mobileMenuButton?.querySelectorAll('span') as NodeListOf<HTMLElement>;
		      if (lines) {
		        lines[0].style.transform = '';
		        lines[1].style.opacity = '1';
		        lines[2].style.transform = '';
		      }
		      
		      // Reset menu items animation
		      mobileNavLinks.forEach((link: HTMLElement) => {
		        link.style.opacity = '0';
		        link.style.transform = 'translateX(20px)';
		      });
		    }

		    // Event listeners
		    mobileMenuButton?.addEventListener('click', openMobileMenu);
		    mobileMenuClose?.addEventListener('click', closeMobileMenu);
		    mobileMenuOverlay?.addEventListener('click', closeMobileMenu);

		    // Close menu when clicking on nav links
		    mobileNavLinks.forEach((link: HTMLElement) => {
		      link.addEventListener('click', () => {
		        setTimeout(closeMobileMenu, 300);
		      });
		    });

		    // Close menu when pressing Escape key
		    document.addEventListener('keydown', function(e: KeyboardEvent) {
		      if (e.key === 'Escape') {
		        closeMobileMenu();
		      }
		    });

		    // Initialize mobile nav links animation state
		    mobileNavLinks.forEach((link: HTMLElement) => {
		      link.style.opacity = '0';
		      link.style.transform = 'translateX(20px)';
		      link.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
		    });

		    // Intersection observer for active sections
		    const sections = document.querySelectorAll("section");
		    const navItems = document.querySelectorAll("header nav a.nav-link");

		    const callback = (entries: IntersectionObserverEntry[]) => {
		      entries.forEach((entry: IntersectionObserverEntry) => {
		        if (entry.isIntersecting) {
		          navItems.forEach((item) => {
		            if (item.getAttribute("aria-label") == entry.target.id) {
		              item.classList.add("text-blue-400");
		            } else {
		              item.classList.remove("text-blue-400");
		            }
		          });
		        }
		      });
		    };

		    const observer = new IntersectionObserver(callback, {
		      root: null,
		      rootMargin: "0px",
		      threshold: 0.3,
		    });

		    sections.forEach((section) => {
		      observer.observe(section);
		    });

		    // Cleanup function
		    document.onvisibilitychange = () => {
		      if (document.visibilityState === "hidden") {
		        observer.disconnect();
		      } else {
		        sections.forEach((section) => {
		          observer.observe(section);
		        });
		      }
		    };

		    // Smooth scrolling mejorado para anchor links
		    document.querySelectorAll('a[href^="#"]').forEach((anchor: Element) => {
		      anchor.addEventListener('click', function (this: HTMLAnchorElement, e: Event) {
		        e.preventDefault();
		        const targetId = this.getAttribute('href')?.substring(1);
		        if (targetId) {
		          const target = document.getElementById(targetId);
		          if (target) {
		            // Calcular offset para navbar fijo
		            const navbarHeight = 80;
		            const targetPosition = target.offsetTop - navbarHeight;
		            
		            // Scroll suave personalizado
		            window.scrollTo({
		              top: targetPosition,
		              behavior: 'smooth'
		            });
		            
		            // Alternativa con easing personalizado para mejor control
		            // smoothScrollTo(targetPosition, 1000);
		          }
		        }
		      });
		    });
		    
		    // Función de scroll suave con easing personalizado (opcional)
		    function smoothScrollTo(targetY: number, duration: number = 1000) {
		      const startY = window.pageYOffset;
		      const distance = targetY - startY;
		      const startTime = new Date().getTime();
		      
		      // Easing function (ease-out-cubic)
		      const easeOutCubic = (t: number): number => {
		        return 1 - Math.pow(1 - t, 3);
		      };
		      
		      function step() {
		        const elapsed = new Date().getTime() - startTime;
		        const progress = Math.min(elapsed / duration, 1);
		        const easedProgress = easeOutCubic(progress);
		        
		        window.scrollTo(0, startY + distance * easedProgress);
		        
		        if (progress < 1) {
		          requestAnimationFrame(step);
		        }
		      }
		      
		      requestAnimationFrame(step);
		    }
		  });
		</script>
	</body>
</html>